package foret.controller;

import javax.servlet.http.HttpServletRequest;

import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.ModelAndView;

import photo.controller.PhotoService;
import region.controller.RegionService;
import tag.controller.TagService;

@Controller
public class ForetController {
	@Autowired
	ForetService foretService;
	@Autowired
	PhotoService photoService;
	@Autowired
	TagService tagService;
	@Autowired
	RegionService regionService;
	
	@RequestMapping(value = "/foret/foret_insert.do")
	public ModelAndView foretWrite(HttpServletRequest request, MultipartFile photo) throws Exception {
		System.out.println("-- 함수 실행 : foret_insert.do --");
		request.setCharacterEncoding("UTF-8");
		
		String foretRT = "FAIL"; 
		String foretTagRT = "FAIL";
		String foretRegionRT = "FAIL";
		String foretPhotoRT = "FAIL";
	    
	    // 포레 등록 후 회원 아이디 가져오기
		int foret_id = insertForet(request);
		
		foretRT = getResult(foret_id);
	    if(foretRT.equals("OK")) {
	    	// 태그, 지역, 사진 등록
	    	foretTagRT = getResult(insertMemberTag(foret_id, request));
	    	foretRegionRT = getResult(insertMemberRegion(foret_id, request));
	    	foretPhotoRT = getResult(insertMemberPhoto(foret_id, request, photo));
	    }
	    
	    JSONObject json = new JSONObject();
	    json.put("memberRT", memberRT);
	    json.put("memberTagRT", memberTagRT);
	    json.put("memberRegionRT", memberRegionRT);
	    json.put("memberPhotoRT", memberPhotoRT);
	    
		System.out.println("-- 함수 종료 : foret_insert.do --\n");
		return modelAndView(json);
	}
	@RequestMapping(value = "/foret/foret_modify.do")
	public ModelAndView foretModify(HttpServletRequest request, MultipartFile photo) throws Exception {
		System.out.println("-- 함수 실행 : foret_modify.do --");
		System.out.println("-- 함수 종료 : foret_modify.do --\n");
		return modelAndView(json);
	}
	@RequestMapping(value = "/foret/foret_delete.do")
	public ModelAndView foretDelete(HttpServletRequest request, MultipartFile photo) throws Exception {
		System.out.println("-- 함수 실행 : foret_delete.do --");
		System.out.println("-- 함수 종료 : foret_delete.do --\n");
		return modelAndView(json);
	}
	
	
	public String getResult(int result) {
		return result > 0 ? "OK" : "FAIL";
	}
	public ModelAndView modelAndView(JSONObject json) {
		ModelAndView modelAndView = new ModelAndView();
	    modelAndView.addObject("json", json);
	    modelAndView.setViewName("member.jsp");
	    return modelAndView;
	}
}
