package member.controller;

import javax.servlet.http.HttpServletRequest;

import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import member.bean.MemberDTO;

@Controller
public class MemberController {
	@Autowired
	MemberService memberService;
	
	@RequestMapping(value = "/member/member_insert.do")
	public ModelAndView memberWrite(HttpServletRequest request) throws Exception {
		request.setCharacterEncoding("UTF-8");
		
		// 기본 정보
		String name = request.getParameter("name");
	    String nickname = request.getParameter("nickname");
	    String birth = request.getParameter("birth");
	    String email = request.getParameter("email");
	    
	    
	    // 태그, 지역, 프로필 사진은 미설정 가능
	    String tag[] = request.getParameterValues("tag");
	    String region_si[] = request.getParameterValues("region_si");
	    String region_gu[] = request.getParameterValues("region_gu");
	    String photo[] = request.getParameterValues("photo");
	    
	    if(tag != null) {
	    	// 실행 내용
	    	for(String s : tag)
	    		System.out.println(s);
	    }
	    if(region_si != null) {
	    	for(String s : region_si)
	    		System.out.println(s);
	    }
	    if(region_gu != null) {
	    	for(String s : region_gu)
	    		System.out.println(s);
	    }
	    if(photo != null) {
	    	for(String s : photo)
	    		System.out.println(s);
	    }
	    
	    // 회원 등록, 사진 등록
	    // 태그, 지역 아이디 찾기
	    // 회원과 (태그, 지역, 사진) 연결
	    	
	    
	    MemberDTO memberDTO = new MemberDTO();
	    memberDTO.setName(name);
	    memberDTO.setNickname(nickname);
	    memberDTO.setBirth(birth);
	    memberDTO.setEmail(email);
	    memberDTO.setTag(tag);
	    memberDTO.setRegion_si(region_si);
	    memberDTO.setRegion_gu(region_gu);
	    memberDTO.setPhoto(photo);
	    
	    int memberResult = memberService.memberWrite(memberDTO);
	    
	    // 회원 등록 후 회원 아이디 가져오기
	    int member_id = memberDTO.getId();
	    System.out.println();
	    System.out.println("------------------");
	    System.out.println("member_id : " + member_id);
	    for(String s : memberDTO.getTag()) {
	    	System.out.print("tag : ");
	    	System.out.println(s);
	    }
	    for(String s : memberDTO.getRegion_si()) {
	    	System.out.print("region_si : ");
	    	System.out.println(s);
	    }
	    for(String s : memberDTO.getRegion_gu()) {
	    	System.out.print("region_gu : ");
	    	System.out.println(s);
	    }
	    for(String s : memberDTO.getPhoto()) {
	    	System.out.print("tag : ");
	    	System.out.println(s);
	    }
	    
	    String memberRT = "FAIL";   
	    if(memberResult > 0) memberRT = "OK";
	    
	    
	    
	    
	    
	    
	    
	    JSONObject json = new JSONObject();
	    json.put("memberRT", memberRT);
	      
	    // 화면 네비게이션
	    ModelAndView modelAndView = new ModelAndView();
	    modelAndView.addObject("json", json);
	    modelAndView.setViewName("member.jsp");
	       
	    return modelAndView;
	}
	
}
